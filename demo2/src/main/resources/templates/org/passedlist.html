<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>passed</title>
    <link rel="stylesheet"  href="../../static/css/mystyle.css">
    <link rel="stylesheet" href="../../static/css/table.css">
    <script src="../../static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../static/layer/layer.js"></script>
</head>
<body>
<table class="my_table">
    <thead  class="td_head">
    <tr>
        <td class="td_check"></td>
        <td class="td_no">记录编号</td>
        <td class="td_date">申请时间</td>
        <td class="td_info">书籍信息</td>
        <td class="td_caount">状态</td>
        <td class="td_status">操作</td>
    </tr>
    </thead>
    <tbody >
    <tr th:each="record : ${result.list}" class="my_tr" >
        <td><input type="checkbox" name="check"></td>
        <td th:text="${record.recordsId}">1</td>
        <td th:text="${#dates.format(record.recordsCreatetime,'yyyy-MM-dd HH:mm:ss')}">2000</td>
        <td>
            <div class="td_book_info">
                <div class="book_img">
                    <img th:src="@{${record.recordsBookCover}}" alt="" class="my_img">
                </div>
                <div class="book_info">
                    <div th:text="'书名:'+${record.recordsBookName}" class="book_info_td">书名</div>
                    <div th:text="'作者:'+${record.recordsBookAuthor}" class="book_info_td">作者</div>
                    <div th:text="'语言:'+${record.recordsBookLanguage}" class="book_info_td">语言</div>
                    <div th:text="'cip:'+${record.recordsBookCip}" class="book_info_td">cip</div>
                    <div th:text="'出版社:'+${record.recordsBookPublisher}" class="book_info_td">出版社</div>
                    <div th:text="'版次:'+${record.recordsBookEdition}" class="book_info_td">版次</div>
                </div>
            </div>
        </td>
        <td>
            <div style="margin-bottom: 5%"><span th:text="${record.recordsStatus}" class="tag is-info is-light">审核通过</span></div>
            <div style="text-align: left;margin-top: 2%">
                <div>审核人员：</div>
                <div th:text="${record.recordsOptAdminNickname}" >审核</div>
                <div>记录更新时间：</div>
                <div th:text="${#dates.format(record.recordsUpdateDatetime,'yyyy-MM-dd HH:mm:ss')}">更新时间</div>
                <!--                <div th:text="'更新时间:'+${record.recordsUpdateDatetime}" class="book_info_td">拒绝原因</div>-->
            </div>
        </td>
        <td>
            <div><button class="button is-danger"  th:onclick="'javascript:withdraw('+${record.recordsId}+',false)'">删除记录</button></div>
            <br>
            <div><button class="button is-success"><a href="/org/putaway">去 上 架</a></button></div>
        </td>
    </tr>
    <tfoot>
    <tr style="background-color:   #ffffe5">
        <td><input type="checkbox" class="checkbox"></td>
        <td>
            <div style="display: flex;font-size: medium;">
                <div style="padding-top: 2%">全选</div>
                <button class="button is-danger" style="margin-left: 10%"  th:onclick="javascript:updateAll(false)">批量删除</button>
            </div>
        </td>
        <td colspan="4">
            <div >
                <ul class="pagination pull-right no-margin">
                    <!-- 首页 -->
                    <li>
                        <a th:href="'/org/getData?pageNum=1&status=passedlist'">首页</a>
                    </li>
                    <!-- 上一页 -->
                    <li th:if="${result.hasPreviousPage}">
                        <a th:href="'/org/getData?pageNum=' + ${result.prePage}+'&status=passedlist'" th:text="上一页"></a>
                    </li>
                    <!-- 中间页 -->
                    <li th:each="pages:${result.navigatepageNums}">
                        <a th:href="'/org/getData?pageNum=' + ${pages}+'&status=passedlist'" th:text="${pages}" ></a>
                        <!--                            <a th:href="'/org/checkinglist?pageNum=' + ${pages}" th:text="${pages}" th:if="${pages eq pageNum}" th:style="'font-weight:bold;background: #6faed9;'"></a>-->
                    </li>
                    <!-- 下一页 -->
                    <li th:if="${result.hasNextPage}">
                        <a th:href="'/org/getData?pageNum=' + ${result.nextPage}+'&status=passedlist'" th:text="下一页"></a>
                    </li>
                    <!-- 尾页 -->
                    <li>
                        <a th:href="'/org/getData?pageNum=' + ${result.size}+'&status=passedlist'">尾页</a>
                    </li>
                </ul>
            </div>
        </td>
    </tr>
    </tfoot>
    </tbody>
</table>
<script type="text/javascript">
    //单条数据撤销申请
    function withdraw(recordId,status) {
        layer.confirm('确定要删除记录吗？注意，删除后不可恢复！',{
            btn:['确认','取消']
        },function () {
            //确认后进行操作
            var data = [];
            data.push(status);
            data.push(recordId);
            processingData(data);
        },function () {

        })
    }
    //以AJAX方式将获取的recordsID数组批量回传到服务端
    function updateAll(status) {
        //获取已经选择的checkbox条数据
        var arr = [];
        //设置这些记录查看状态为false
        arr.push(status);
        //组织数据，选中所有的被选中的数据的id
        $("input[name='check']:checked").each(function (i) {
            let val = $(this).parents("tr").find("td").eq(1).text();
            arr.push($.trim(val));
        })
        console.log(arr);
        //将数据传输到后台
        processingData(arr);
    }
    function processingData(data) {
        $.ajax({
            type:'post',
            url:'/org/changeUploadRecords',
            contentType:"application/json",
            data:JSON.stringify(data),
            success:function (message) {
                layer.msg(message,{
                    time:3000,
                    btn:['确认']
                },function () {
                    location.reload(true);
                    // location.replace("/org/checkinglist?pageNum=1");
                })
            }
        })
    }
</script>
</body>
</html>